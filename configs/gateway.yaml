# API Gateway Configuration

Name: aetherflow-gateway
Host: 0.0.0.0
Port: 8080
Mode: dev  # dev, test, prod

# 日志配置
Log:
  ServiceName: aetherflow-gateway
  Mode: console  # console, file, volume
  Path: logs/gateway
  Level: info  # debug, info, warn, error
  Compress: false
  KeepDays: 7
  StackCooldownMillis: 100

# 超时配置
Timeout: 30000  # 30秒 (毫秒)

# CORS配置
Cors:
  Enable: true
  AllowOrigins:
    - "*"
  AllowMethods:
    - GET
    - POST
    - PUT
    - DELETE
    - OPTIONS
  AllowHeaders:
    - Content-Type
    - Authorization
    - X-Request-ID
    - X-Session-ID
  ExposeHeaders:
    - X-Request-ID
  AllowCredentials: true
  MaxAge: 3600

# Etcd服务发现配置
Etcd:
  Enable: false               # 是否启用服务发现
  Endpoints:
    - "127.0.0.1:2379"       # Etcd endpoints
  DialTimeout: 5             # 连接超时（秒）
  Username: ""               # 用户名（可选）
  Password: ""               # 密码（可选）
  ServiceTTL: 10             # 服务注册TTL（秒）
  ServiceName: "aetherflow-gateway"
  ServiceAddr: "localhost:8888"
  
# Session Service配置
SessionService:
  Endpoints:
    - 127.0.0.1:50051
  Timeout: 5000  # 5秒
  
# StateSync Service配置
StateSyncService:
  Endpoints:
    - 127.0.0.1:50052
  Timeout: 5000  # 5秒

# 链路追踪配置
Tracing:
  Enable: false                             # 是否启用追踪
  ServiceName: aetherflow-gateway           # 服务名称
  Endpoint: http://localhost:14268/api/traces  # Jaeger endpoint (或 Zipkin: http://localhost:9411/api/v2/spans)
  Exporter: jaeger                          # 导出器类型: jaeger 或 zipkin
  SampleRate: 1.0                           # 采样率 (0.0-1.0, 1.0=100%)
  Environment: development                   # 环境: development, staging, production
  BatchTimeout: 5                            # 批量发送超时（秒）
  MaxQueueSize: 2048                         # 最大队列大小

# Prometheus配置
Prometheus:
  Host: 0.0.0.0
  Port: 9091
  Path: /metrics

# 限流配置
RateLimit:
  Enable: true
  Rate: 100  # 每秒请求数
  Burst: 200  # 突发容量

# 熔断配置
Breaker:
  Enable: true
  Threshold: 0.5           # 错误率阈值
  MinRequests: 5           # 最小请求数
  ConsecutiveFailures: 5   # 连续失败阈值
  Timeout: 60              # 熔断超时（秒）
  HalfOpenRequests: 3      # 半开状态最大请求数

# 健康检查配置
Health:
  Enable: true
  Interval: 10  # 秒
  Timeout: 3    # 秒

# JWT配置
JWT:
  Secret: "aetherflow-secret-key-change-in-production"
  Expire: 86400      # 24小时 (秒)
  RefreshExpire: 604800  # 7天 (秒)
  Issuer: "aetherflow"

# gRPC服务端点配置
GRPC:
  # Session服务
  Session:
    Target: "127.0.0.1:9001"
    Timeout: 5000      # 毫秒
    MaxRetries: 3
    Transport: "quantum"  # tcp 或 quantum
    UseDiscovery: false   # 是否使用服务发现
    DiscoveryName: "session"  # 服务发现名称
  # StateSync服务
  StateSync:
    Target: "127.0.0.1:9002"
    Timeout: 5000      # 毫秒
    MaxRetries: 3
    Transport: "quantum"  # tcp 或 quantum
    UseDiscovery: false   # 是否使用服务发现
    DiscoveryName: "statesync"  # 服务发现名称
  # 连接池配置
  Pool:
    MaxIdle: 10        # 最大空闲连接数
    MaxActive: 100     # 最大活跃连接数
    IdleTimeout: 60    # 空闲超时(秒)
  # 负载均衡配置
  LoadBalancer:
    Policy: "round_robin"  # round_robin, random, consistent_hash
